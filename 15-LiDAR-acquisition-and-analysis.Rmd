# LiDAR Acquisition and Analysis {#LiDAR-acquisition-and-analysis}

**Bold Text**, _Italicized Text_ Regular Text.

:::: {.box-content .learning-objectives-content}

::: {.box-title .learning-objectives-top}
#### Learning Objectives {-}
::: 

1. Understand _how_ LiDAR works
2. Understand _what_ we can do with LiDAR data
3. Understand the basic processing steps required to use LiDAR data in a forestry context

::::

### Key Terms {-}

LiDAR, ALS, Surface Models, LiDAR Metrics, Area-Based Approach, Individual Tree Detection 

## What is LiDAR?

LiDAR is an active remote sensing technology

- Alternate names
- How it works
  - Basic components
- Multipe types of LiDAR
- Brief history in forestry / what can we do with LiDAR

The most common file format for LiDAR files is called the LAS file format (.las). This file format was originally designed for 3-dimensional point cloud data, and is a free alternative to proprietary systems or a generic ASCII file interchange system. The main benefits of this file format are that it is relatively quick, can be used by any system, and stores information specific to the nature of LiDAR data wihtout being overly complex (:https://www.asprs.org/divisions-committees/lidar-division/laser-las-file-format-exchange-activities).  


![Figure X Concept of LiDAR.](images/15-Concept_of_LiDAR.png){.center}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut in dolor nibh. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent et augue scelerisque, consectetur lorem eu, auctor lacus. Fusce metus leo, aliquet at velit eu, aliquam vehicula lacus. Donec libero mauris, pharetra sed tristique eu, gravida ac ex. Phasellus quis lectus lacus. Vivamus gravida eu nibh ac malesuada. Integer in libero pellentesque, tincidunt urna sed, feugiat risus. Sed at viverra magna. Sed sed neque sed purus malesuada auctor quis quis massa.

:::: {.box-content .your-turn-content}

::: {.box-title .your-turn-top}
#### Your turn! {-}
:::

<iframe width=100% height=800px src='https://paulpickell.ca/scenejs-test/' frameBorder="0" >
  <p>Your browser does not support iframes</p>
</iframe>

::::


![Figure X LiDAR System.](images/15-LiDAR_System.png){.center}

## Components of LiDAR Systems


### Platform

- LiDAR units can be attached to a variety of platforms. Traditionally, LiDAR units were mounted on airplanes and helicopters, as units were large and cumbersome [Figure X for actual scanner].

- Cars:
![Figure X Mobile LiDAR System.](images/15-Mobile_LiDAR.jpg){.center}

- Drone: As technology has improved and laser units have gotten smaller, we can mount LiDAR units to drones (also known as...)
![Figure X Drone mounted LiDAR.](images/15-LiDAR_on_Drone_2.jpg){.center}

- MLS/backpack
- Satellite based
![Figure X GEDI.](images/15-GEDI.jpg){.center}

### Lasers
- Typical wavelengths (eye safe, NIR vs green)
- Power

![Figure X LiDAR Unit.](images/15-LiDAR_Unit.jpg){.center}

### Clocks
- ???

### Global Navigation Satellite Systems
- Require us to know our position exactly!
- Callback to GNSS? 
- 

![Figure X XYZ Coordinates.](images/15-XYZ_coordinates.jpg){.center}

### Inertial Measurement Unit (IMU)

- Mentioned elswhere? What is it - focus on image that discusses pitch/roll/yaw

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut in dolor nibh. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent et augue scelerisque, consectetur lorem eu, auctor lacus. Fusce metus leo, aliquet at velit eu, aliquam vehicula lacus. Donec libero mauris, pharetra sed tristique eu, gravida ac ex. Phasellus quis lectus lacus. Vivamus gravida eu nibh ac malesuada. Integer in libero pellentesque, tincidunt urna sed, feugiat risus. Sed at viverra magna. Sed sed neque sed purus malesuada auctor quis quis massa. 


## Types of LiDAR


![Figure X LiDAR Discrete vs Full Waveform.](images/15-LiDAR_Discrete_Full_Waveform.png){.center}

### Discrete Return

### Full Waveform
### Multispectral

[This is how we link to something. {target="_blank"} ensures that this link opens in a new window rather than navigating away from the textbook.](https://google.com){target="_blank"}


Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut in dolor nibh. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent et augue scelerisque, consectetur lorem eu, auctor lacus. Fusce metus leo, aliquet at velit eu, aliquam vehicula lacus. Donec libero mauris, pharetra sed tristique eu, gravida ac ex. Phasellus quis lectus lacus. Vivamus gravida eu nibh ac malesuada. Integer in libero pellentesque, tincidunt urna sed, feugiat risus. Sed at viverra magna. Sed sed neque sed purus malesuada auctor quis quis massa.

:::: {.box-content .call-out-content}

::: {.box-title .call-out-top}
#### Call out {-}
:::

<p id="box-text">
This is a call out. Put some important concept or fact in here.
</p>

::::

## LiDAR Derivatives and Analysis
- What can we do with LiDAR derivatives, why are they important

### Bare Earth Elevation

- What is a DEM

### Canopy Height Model

- What is a CHM

### Canopy Surface Model

- CHM vs DSM? 

### Grid Metrics

- What are these used for 

### Tree Segmentation

-How and why would we want too do this

![Figure X Processing Flowchart.](images/Processing_Flowchart.png){.center}

:::: {.box-content .case-study-content}

::: {.box-title .case-study-top}
#### Case Study {-}
:::

#### Creating LiDAR Metrics from a Raw Point Cloud {#box-text -}

<p id="box-text">For this case study, we will be using a clipped .las file from the 2018 open LiDAR dataset of City of Vancouver and UBC Endowment Lands in British Columbia (we randomly selected a 200 x 200 meter portion of the ‘4840E_54550N’ tile, see below for the link where you can download the data), and the `lidR` package in R. The script to process this data is included HERE [where to include script?], and you can use the `lidR` book [link] to get a more in depth understanding of the functions we apply below.</p>

<p id="box-text">The first step when looking at LiDAR data is to inspect it; we recommend using the free software CloudCompare (link below), or the `plot()` function in the `lidR` package. Once we have a sense of our data, we can clean and filter the data, using `classify_noise()` and the ‘-drop’ switch to get rid of the noise in our dataset [include image showing noisy vs. clean data?]. Our cleaned dataset can then be used to create a DEM; first we can `classify_ground()`, followed by using the `grid_terrain()` function [call back to previous chapter] – this is an essential step that could require quite a bit of tweaking depending on what you want to use the DEM for! In our case, the DEM is used to _normalize_ the point cloud. Normalization removes the effect of terrain on above ground measurements, allowing comparisons of vegetation heights. [insert image of DEM and CHM]. The normalized point cloud is used to create our CHM (created using `grid_canopy()`). It is at this point that we can analyze the point cloud in a variety of ways. We can use an area-based approach (ABA) to create metrics at the grid level (`grid_metrics()`), or we can derive metrics at the individual tree scale. In order to do this we need to first segment the trees (`segment_trees()`) before creating metrics (`tree_metrics()`). Below we can see an example of a segmented point cloud.</p>

<p id="box-text">Case studies should have at least one image or map (no more than 2 total) and the written length should be around 300 words (shown above). Any references to external literature should by hyperlinked with the Digitial Object Identifier (DOI) permanent URL and [entered into the bibliography](https://bookdown.org/yihui/bookdown/citations.html){target="_blank"}. Avoid linking to external resources without a DOI and permanent URL. Contact Paul or try using the Leaflet package in R if you want to add an interactive web map.</p>

::::



:::: {.box-content .your-turn-content}

::: {.box-title .your-turn-top}
#### Your turn! {-}
:::

<p id="box-text">Explore some of the LiDAR derivatives that we produced in the case study above</p>

<p id="box-text">Interactive map of rasters:

- DEM

- CHM

- and some grid metrics - e.g. mean and p99?</p>

<p id="box-text">Screenshot vs. interactive point cloud - data size concerns</p>

<p id="box-text">Necessity of being able to rotate point cloud? Relatively little gain for trouble of small area.</p>

</p>

<iframe width=100% height=800px src='http://paulpickell.ca/raster-calculator/low-pass-filter.html' frameBorder="0" >
  <p>Your browser does not support iframes</p>
</iframe>

::::


## Summary

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut in dolor nibh. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent et augue scelerisque, consectetur lorem eu, auctor lacus. Fusce metus leo, aliquet at velit eu, aliquam vehicula lacus. Donec libero mauris, pharetra sed tristique eu, gravida ac ex. Phasellus quis lectus lacus. Vivamus gravida eu nibh ac malesuada. Integer in libero pellentesque, tincidunt urna sed, feugiat risus. Sed at viverra magna. Sed sed neque sed purus malesuada auctor quis quis massa.

### Reflection Questions {-}

1. Explain ipsum lorem.
2. Define ipsum lorem.
3. What is the role of ispum lorem?
4. How does ipsum lorem work?

### Practice Questions {-}

2. Given ipsum, solve for lorem.
3. Draw ipsum lorem.

`r if (knitr::is_html_output()) '
## Recommended Readings {-}
'`

Ensure all inline citations are properly referenced here.

```{r include=FALSE}
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown', 'htmlwidgets', 'webshot', 'DT',
  'miniUI', 'tufte', 'servr', 'citr', 'rticles'
), 'packages.bib')
```
